每个边最多属于一个简单环的无向联通图是仙人掌

---

以下细节可能有问题，比如边带权的情况，但是对应条件稍胡一下就行了

- 找环

考虑如果遍历仙人掌得到根到所有点的距离，可以最短路，对于两个点如果有边但是没有转移，也就是 $(x,y)\in E,abs(d_x-d_y)\neq 1$，那么必然存在环

考虑在 $dfs$ 的过程中暴力跳父亲找到 $lca$，这样复杂度是正确的因为每个链不会被两个以上的环包含

跳的时候哪边 $dep$ 大跳哪边就行

图上还有一个“母亲节点”的定义，也就是非转移方向的环上相邻点，可以用各种实现来找到

- 环的总长度

对于两个不转移的相邻节点，找到 $lca$ 之后计算即可，对环的标号可以对环顶和两个儿子来找

儿子可以找 $lca$ 的时时候维护

- 所在环的节点的标号

每个环不在链顶处记标号，环上的其它节点上记录

- 仙人掌上两点最短路？

维护上面的信息之后，讨论一下：

$(1)$ 一个是另一个的祖先：$d_x-d_y$ 

这个部分不合剩下的重合，同时不因为环的问题更改答案

$(2)$ 属于一个环：$\min(d_x+d_y-2d_{top},len[id]-(d_x+d_y-2d_{top}))$

$(3)$ 不属于一个环：$d_x+d_y-2d_{lca}$

注意一个点的 部分祖先和另一个点在一个环上的部分

这样可以解决 $bzoj2125$

（貌似说了很多，其实就是在最短路树上处理一下非树边就行了）